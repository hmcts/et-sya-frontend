#!groovy

properties([
  pipelineTriggers([cron('H 23 * * 1-5')])
])

@Library("Infrastructure")

def yarnBuilder = new uk.gov.hmcts.contino.YarnBuilder(this)
def type = "nodejs"
def product = "et"
def component = "sya"

withNightlyPipeline(type, product, component) {
  enableSlackNotifications('#et-builds')

  stage('Stryker mutation testing') {
    try {
      yarnBuilder.yarn('test:mutation')
    } finally {
      publishHTML([
        allowMissing         : true,
        alwaysLinkToLastBuild: true,
        keepAll              : true,
        reportDir            : 'reports/mutation',
        reportFiles          : 'mutation.html',
        reportName           : 'Stryker Mutation Report'
      ])
      steps.archiveArtifacts allowEmptyArchive: true, artifacts: 'reports/mutation/**'
      steps.archiveArtifacts allowEmptyArchive: true, artifacts: 'reports/stryker-incremental.json'
    }
  }
}
