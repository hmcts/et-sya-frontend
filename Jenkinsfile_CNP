#!groovy

@Library("Infrastructure")

import uk.gov.hmcts.contino.AppPipelineDsl

def type = "nodejs"
def product = "et"
def component = "sya"
def branchesToSync = ['perftest']

def yarnBuilder = new uk.gov.hmcts.contino.YarnBuilder(this)

withPipeline(type, product, component) {
  disableLegacyDeployment()
  syncBranchesWithMaster(branchesToSync)

  after('build') {
    yarnBuilder.yarn('build')
  }

  after('functionalTest:aat') {
      stage('Accessibiltiy') {
          yarnBuilder.yarn('tests:a11y')
          publishHTML([
              allowMissing         : true,
              alwaysLinkToLastBuild: true,
              keepAll              : true,
              reportDir            : "functional-output/accessibility-report",
              reportFiles          : 'a11y.html',
              reportName           : 'et-sya-frontend'
      ])
      }
  } 
  after('functionalTest:preview') {
      stage('Accessibiltiy') {
          yarnBuilder.yarn('tests:a11y')
          publishHTML([
              allowMissing         : true,
              alwaysLinkToLastBuild: true,
              keepAll              : true,
              reportDir            : "functional-output/accessibility-report",
              reportFiles          : 'a11y.html',
              reportName           : 'et-sya-frontend'
        ])
      }
  } 

  enablePactAs([
    AppPipelineDsl.PactRoles.CONSUMER
   ])
}
